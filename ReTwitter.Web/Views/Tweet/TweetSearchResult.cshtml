@model ReTwitter.Web.Models.TweetViewModel.TweetSearchResultViewModel

@{
    ViewData["Title"] = "Latest 100 tweets";
}

<br />
<br />
<br />

@if (@Model.TweetSearchResults.Count() != 0)
{
<table class="table">
    <tr>
        <th>
            Text
        </th>
        <th>
            Original Tweet Created On
        </th>
        <th></th>
        <th></th>
    </tr>

    @foreach (var item in Model.TweetSearchResults)
    {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Text)
        </td>
        <td>
            @item.OriginalTweetCreatedOn.Substring(0, 10)
        </td>
        <td>
            @*@Html.ActionLink("Save", "TweetAdd", "Tweet", new { tweetId = item.TweetId }, new { @class = "btn btn-info" })*@
            <button id="@item.TweetId" class="btn btn-palegreen btn-sm pull-right">Save</button>

        </td>
        <td><a class="btn btn-info" href="@string.Concat(" https://twitter.com/intent/retweet?tweet_id=", item.TweetId)">Retweet</a></td>
    </tr>
    }
</table>
}

@section Scripts{
<script src="https://unpkg.com/sweetalert2@7.19.0/dist/sweetalert2.all.js"></script>
<script>
    $(document).ready(function () {
        $('button').on('click', function (e) {

            event.preventDefault();
            var id = $(this).attr('id');

            $.ajax(swal({
                title: 'Are you sure?',
                text: "You will save this tweet in your personal database!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, save it!',
                cancelButtonText: 'No, cancel!',
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger',
                buttonsStyling: false,
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: "/Tweet/TweetAdd/" + id,
                        type: "POST",
                        success: (response) => {
                            if (response) {
                                swal('Congrats!',
                                    'You successfully saved the tweet!',
                                    'success'
                                )} else {
                                swal(

                                    'Oops...',
                                    'You already saved this tweet some time ago!',
                                    'error'
                                )}
                        },
                        error: (response) => {
                            console.log(response);
                        }})
                } else if (
                    result.dismiss === swal.DismissReason.cancel
                ) {
                    swal(
                        'Cancelled',
                        'Tweet is not in your list yet!',
                        'error'
                    )
                }
            }));
        });
    });
</script>
}